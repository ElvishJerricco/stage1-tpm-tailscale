This code is not exactly good. It's a bit of a mess that's thrown
together to make this work. It could be very much improved.
